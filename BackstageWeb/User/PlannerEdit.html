
<!DOCTYPE html>
<html>
<head>
    <title>规划师信息</title>
    <link href="/Resource/Style/ivory.css?v=3" rel="stylesheet" type="text/css" />
    <link href="/Resource/Style/main.css?v=3" rel="stylesheet" type="text/css" />
    <link href="/Resource/Style/FortAwesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <script src="/Resource/Script/jquery.min.js" type="text/javascript"></script>
    <script src="/Resource/Script/jqueryupload/jqueryupload.js" type="text/javascript"></script>
    <script src="/Resource/Script/common.js?v=5" type="text/javascript"></script>
    <script type="text/javascript" src="/Resource/Script/jquery.validate.js"></script>


<style type="text/css">
    .ImportBox {
        position: relative;
        cursor: default;
    }

    .Import {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 30px;
        font-size: 0px;
        font-size: 200px\9;
        overflow: hidden;
        filter: alpha(opacity=0);
        -moz-opacity: 0;
        -khtml-opacity: 0;
        opacity: 0;
        cursor: pointer;
    }
</style>

</head>
<body>
    
        <div id="contentheader">
            <div id="contentheader_title">规划师信息</div>
            <div id="contentheader_button">
                <button onclick="parent.gotoPage('/User/PlannerIndex.html');" type="button"><i class="fa fa-times"></i>&nbsp;取消</button>
            </div>
            <div style="clear:both;"></div>
        </div>

        <div id="content">
            <div class="area" style="margin-bottom:35px;">
            <div class="area_title">编辑规划师</div>
                <form id="submitForm">
                    <table border="1" cellpadding="0" cellspacing="0" style="width: 80%;">
                        <tr>
                            <th width="100">帐号</th>
                            <td>
                                <input id="Account" maxlength="50" name="Account" placeholder="输入帐号" value="" type="text">
                            </td>
                            <th width="100">手机号码</th>
                            <td>
                                <input id="Phone" maxlength="20" name="Phone" placeholder="输入手机号码" value="" type="text">
                            </td>
                            <th width="100">用户类型</th>
                            <td>
                                <select id="UserType" name="UserType">
                                    <option value="1">普通用户</option>
                                    <option value="2">菜鸟规划师</option>
                                    <option value="3">规划师</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th width="100">姓名</th>
                            <td>
                                <input id="Name" maxlength="20" name="Name" placeholder="输入姓名" value="" type="text">
                                <input id="UserId" maxlength="20" name="UserId" value="" type="hidden">
                            </td>
                            <th width="100">性别</th>
                            <td>
                                <select id="Sex" name="Sex">
                                    <option value="1">男</option>
                                    <option value="2">女</option>
                                </select>
                            </td>
                            <th width="100">年龄</th>
                            <td>
                                <input id="Age" maxlength="3" name="Age" placeholder="输入年龄" value="" type="text">
                            </td>
                        </tr>
                        <tr>
                            <th width="100">学历</th>
                            <td>
                                <input id="Education" maxlength="256" name="Education" placeholder="输入学历" value="" type="text">
                            </td>
                            <th width="100">地址</th>
                            <td>
                                <input id="Address" maxlength="256" name="Address" placeholder="输入地址" value="" type="text">
                            </td>
                            <th width="100">邮箱</th>
                            <td>
                                <input id="Email" maxlength="256" name="Email" placeholder="输入邮箱" value="" type="text">
                            </td>
                        </tr>
                        <tr>
                            <th width="100">服务区域</th>
                            <td colspan="5">
                                <div id="checkbox_sa"></div>
                                <input id="ServiceAreaId" maxlength="20" name="ServiceAreaId" value="" type="hidden">
                            </td>
                        </tr>
                        <tr>
                            <th width="100">服务类型</th>
                            <td colspan="5">
                                <div id="checkbox_st"></div>
                                <input id="ServiceTypeId" maxlength="20" name="ServiceTypeId" value="" type="hidden">
                            </td>
                        </tr>
                    <tr>
                        <th width="100">头像</th>
                        <td colspan="3">
                            <img src="" id="HeadImageView" width="100px" height="100px">
                            <input id="HeadImage" maxlength="256" name="HeadImage" value="" type="hidden">
                            <a href="javascript:;" style="font-size:12px;margin:auto 5px;margin-top:10px;color:#333333; width: 70%" id="ImportBox" class="ImportBox">
                                &nbsp;&nbsp;<i class="fa fa-upload"></i>上传头像
                                <input type="file" id="Import" name="file" class="Import" />
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <th width="100">身份证号码</th>
                        <td colspan="5">
                            <input id="IDCard" maxlength="20" name="IDCard" value="" placeholder="输入身份证号码" type="text" style="width: 100%;">
                        </td>
                    </tr>
                    <tr>
                        <th width="100">身份证正面</th>
                        <td>
                            <img src="" id="IDCardJustView" width="100px" height="100px">
                            <input id="IDCardJust" maxlength="256" name="IDCardJust" value="" type="hidden">
                            <a href="javascript:;" style="font-size:12px;margin:auto 5px;margin-top:10px;color:#333333; width: 70%" id="ImportBoxIDCardJust" class="ImportBox">
                                &nbsp;&nbsp;<i class="fa fa-upload"></i>上传身份证正面
                                <input type="file" id="ImportIDCardJust" name="file" class="Import" />
                            </a>
                        </td>
                        <th width="100">身份证反面</th>
                        <td>
                            <img src="" id="IDCardBackView" width="100px" height="100px">
                            <input id="IDCardBack" maxlength="256" name="IDCardBack" value="" type="hidden">
                            <a href="javascript:;" style="font-size:12px;margin:auto 5px;margin-top:10px;color:#333333; width: 70%" id="ImportBoxIDCardBack" class="ImportBox">
                                &nbsp;&nbsp;<i class="fa fa-upload"></i>上传身份证反面
                                <input type="file" id="ImportIDCardBack" name="file" class="Import" />
                            </a>
                        </td>
                    </tr>
                    </table>

                </form>
                <div style="text-align:right;margin:15px 0 5px 0;">
                    <button type="submit" class="orange" onclick="submitForm();"><i class="fa fa-floppy-o"></i>&nbsp;保存</button>
                </div>
            </div>
            <div class="area" style="margin-bottom:35px;">
            <div class="area_title">学历背景<a href="javascript:;" style="font-size:12px;float:right;margin:auto 5px;" id="AddEducation" onclick="AddEducation()"><i class="fa fa-plus-square"></i> 新增</a></div>

            <table border="1" cellpadding="0" cellspacing="0" class="table" id="EducationList">
                <thead>
                    <tr>
                        <th width="15%">时间起</th>    
                        <th width="15%">时间止</th>
                        <th width="10%">学位</th>
                        <th width="20%">毕业大学</th>
                        <th width="10%">操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            </div>
            <div class="area" style="margin-bottom:35px;">
            <div class="area_title">社会背景<a href="javascript:;" style="font-size:12px;float:right;margin:auto 5px;" id="AddSociety" onclick="AddSociety()"><i class="fa fa-plus-square"></i> 新增</a></div>

            <table border="1" cellpadding="0" cellspacing="0" class="table" id="SocietyList">
                <thead>
                    <tr>
                        <th width="15%">时间起</th>    
                        <th width="15%">时间止</th>
                        <th width="30%">社会背景</th>
                        <th width="10%">操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            </div>
            <div class="area" style="margin-bottom:35px;">
            <div class="area_title">资源背景<a href="javascript:;" style="font-size:12px;float:right;margin:auto 5px;" id="AddResour" onclick="AddResour()"><i class="fa fa-plus-square"></i> 新增</a></div>
            
            <table border="1" cellpadding="0" cellspacing="0" class="table" id="ResourList">
                <thead>
                    <tr>
                        <th width="15%">时间起</th>    
                        <th width="15%">时间止</th>
                        <th width="30%">资源背景</th>
                        <th width="10%">操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            </div>
        </div>
</body>
</html>
<script type="text/javascript">
    var submitForm = function () {
        var sa_ids = ""
        $.each($("#checkbox_sa [type=checkbox]"),function(i,item){
            if(item.checked){
                if(sa_ids.length>0){
                    sa_ids+=",";
                }
                sa_ids+=$(item).val();
            }
        })
        $("#ServiceAreaId").val(sa_ids);
        var st_ids = ""
        $.each($("#checkbox_st [type=checkbox]"),function(i,item){
            if(item.checked){
                if(st_ids.length>0){
                    st_ids+=",";
                }
                st_ids+=$(item).val();
            }
        })
        $("#ServiceTypeId").val(st_ids);
        /*$("#submitForm").validate({
            rules: {
                Name: {
                    required: true
                }, Age: {
                    number: true
                }
            }, messages: {
                Name: {
                    required: "请输入名称"
                }, Age: {
                    number: "年龄必须为数字"
                }
            }, submitHandler: function () {*/
                $.ajaxForm("/user/back_updateplanner", "submitForm",
                function (result) {
                    if (result.status=="200") {
                        $.alert("规划师修改成功", function () {
                            //parent.gotoPage("/User/UserIndex.html");
                            $(window.top.document).contents().find("#pageContent")[0].contentWindow.queryList(1);
                            $.layerClose();
                        });
                    } else {
                        $.alert("规划师修改失败,失败原因："+result.message);
                    }
                },
                function () {
                    $.alert("网络故障，请稍候重试!");
                });
           /* }
        });*/

    };
    var userid=""
$(function(){
    userid = getUrlParam("id");
        $("#Import").change(function () { ImportFile("Import","HeadImage","HeadImageView"); });
        $("#ImportIDCardJust").change(function () { ImportFile("ImportIDCardJust","IDCardJust","IDCardJustView"); });
        $("#ImportIDCardBack").change(function () { ImportFile("ImportIDCardBack","IDCardBack","IDCardBackView"); });
        
        
    loadPlannerInfo(userid);
    loadServiceType();
    loadServiceArea();
    loadEducationList(userid);
    loadSocietyList(userid);
    loadResourList(userid);
})
function loadPlannerInfo(userid){
    $.ajaxJson("/planner/select_planner_info", { userid: userid },
            function (result) {
                if (!!result.data) {
                    $("#UserId").val(result.data.Id)
                    $("#Account").val(result.data.Account)
                    $("#Phone").val(result.data.Phone)
                    $("#UserType").val(result.data.UserType)
                    $("#Name").val(result.data.Name)
                    $("#Education").val(result.data.Education)
                    $("#Sex").val(result.data.Sex)
                    $("#Age").val(result.data.Age)
                    $("#Address").val(result.data.Address)
                    $("#Email").val(result.data.Email)
                    $("#HeadImage").val(result.data.HeadImage)
                    $("#HeadImageView").attr("src", "/" + result.data.HeadImage)
                    $("#IDCard").val(result.data.IDCard)
                    $("#IDCardJust").val(result.data.IDCardJust)
                    $("#IDCardJustView").attr("src", "/" + result.data.IDCardJust)
                    $("#IDCardBack").val(result.data.IDCardBack)
                    $("#IDCardBackView").attr("src", "/" + result.data.IDCardBack)
                    $("#ServiceAreaId").val(result.data.ServiceAreaId)
                    $("#ServiceTypeId").val(result.data.ServiceTypeId)
                    loadCheckList()
                } else {
                    $.alert(result.message);
                }
            },
            function () {
                    $.alert("网络故障，请稍候重试!");
            }
        );
}
function loadServiceType(){
    $.ajaxJson("/system/select_service_type_list", { page: 1,size:30 },
        function (result) {
            if (!!result.data) {
                var html=""
                for (var i = 0; i < result.data.length; i++) {
                    if(i%10==0){
                        html += "<br />"
                    }
                    html += '<label><input id="ServiceTypeId_'+result.data[i].Id+'" type="checkbox" value="'+result.data[i].Id+'" />'+result.data[i].Name+' </label> ';
                }
                $("#checkbox_st").html(html);
                loadCheckList()
            } else {
                $.alert(result.message);
            }
        },
        function () {
                $.alert("网络故障，请稍候重试!");
        }
    );
}
function loadServiceArea(){
    $.ajaxJson("/system/select_service_area_list", { page: 1,size:30 },
            function (result) {
                if (!!result.data) {
                    var html=""
                    for (var i = 0; i < result.data.length; i++) {
                        if(i%10==0){
                            html += "<br />"
                        }
                        html += '<label><input id="ServiceAreaId_'+result.data[i].Id+'" type="checkbox" value="'+result.data[i].Id+'" />'+result.data[i].Name+' </label> ';
                    }
                    $("#checkbox_sa").html(html);
                    loadCheckList()
                    
                } else {
                    $.alert(result.message);
                }
            },
            function () {
                    $.alert("网络故障，请稍候重试!");
            }
        );
}
function loadEducationList(userid){
    $.ajaxJson("/planner/select_education_list", { userid: userid},
        function (result) {
            if (result && result.data.length > 0) {
                var list = result.data;
                var html = "";
                for (var i = 0; i < result.data.length; i++) {
                    html += "<tr " + (i % 2 == 1 ? "class='even'" : "") + ">";
                    html += "<td>" + (list[i].TimeStart ? list[i].TimeStart : "") + "</td>";
                    html += "<td>" + (list[i].TimeEnd ? list[i].TimeEnd : "") + "</td>";
                    html += "<td>" + (list[i].Degree ? list[i].Degree : "") + "</td>";
                    html += "<td>" + (list[i].University ? list[i].University : "") + "</td>";
                    html += "<td>";
                        html += "<a href='javascript:void(0);' onclick='EditEducation(\"" + list[i].Id + "\")' title='编辑'>编辑</a>&nbsp;";
                        html += "<a href='javascript:void(0);' onclick='DeleteEducation(\"" + list[i].Id + "\")' title='删除'>删除</a>&nbsp;";
                    html += "</td>";
                    html += "</tr>";
                }
                $("#EducationList tbody").html(html);
            } else {
                $("#EducationList tbody").html("<tr><td colspan='" + $("#EducationList thead tr th").length + "'>没有任何数据</td></tr>");
            }
        },
        function () {
            $("#EducationList tbody").html("<tr><td colspan='" + $("#EducationList thead tr th").length + "'>网络故障，请稍候重试！</td></tr>");
        }
    );
}
function loadSocietyList(userid){
    $.ajaxJson("/planner/select_society_list", { userid: userid},
        function (result) {
            if (result && result.data.length > 0) {
                var list = result.data;
                var html = "";
                for (var i = 0; i < result.data.length; i++) {
                    html += "<tr " + (i % 2 == 1 ? "class='even'" : "") + ">";
                    html += "<td>" + (list[i].TimeStart ? list[i].TimeStart : "") + "</td>";
                    html += "<td>" + (list[i].TimeEnd ? list[i].TimeEnd : "") + "</td>";
                    html += "<td>" + (list[i].Description ? list[i].Description : "") + "</td>";
                    html += "<td>";
                        html += "<a href='javascript:void(0);' onclick='EditSociety(\"" + list[i].Id + "\")' title='编辑'>编辑</a>&nbsp;";
                        html += "<a href='javascript:void(0);' onclick='DeleteSociety(\"" + list[i].Id + "\")' title='删除'>删除</a>&nbsp;";
                    html += "</td>";
                    html += "</tr>";
                }
                $("#SocietyList tbody").html(html);
            } else {
                $("#SocietyList tbody").html("<tr><td colspan='" + $("#SocietyList thead tr th").length + "'>没有任何数据</td></tr>");
            }
        },
        function () {
            $("#SocietyList tbody").html("<tr><td colspan='" + $("#SocietyList thead tr th").length + "'>网络故障，请稍候重试！</td></tr>");
        }
    );
}
function loadResourList(userid){
    $.ajaxJson("/planner/select_resour_list",{ userid: userid },
        function (result) {
            if (result && result.data.length > 0) {
                var list = result.data;
                var html = "";
                for (var i = 0; i < result.data.length; i++) {
                    html += "<tr " + (i % 2 == 1 ? "class='even'" : "") + ">";
                    html += "<td>" + (list[i].TimeStart ? list[i].TimeStart : "") + "</td>";
                    html += "<td>" + (list[i].TimeEnd ? list[i].TimeEnd : "") + "</td>";
                    html += "<td>" + (list[i].Description ? list[i].Description : "") + "</td>";
                    html += "<td>";
                        html += "<a href='javascript:void(0);' onclick='EditResour(\"" + list[i].Id + "\")' title='编辑'>编辑</a>&nbsp;";
                        html += "<a href='javascript:void(0);' onclick='DeleteResour(\"" + list[i].Id + "\")' title='删除'>删除</a>&nbsp;";
                    html += "</td>";
                    html += "</tr>";
                }
                $("#ResourList tbody").html(html);
            } else {
                $("#ResourList tbody").html("<tr><td colspan='" + $("#ResourList thead tr th").length + "'>没有任何数据</td></tr>");
            }
        },
        function () {
            $("#ResourList tbody").html("<tr><td colspan='" + $("#ResourList thead tr th").length + "'>网络故障，请稍候重试！</td></tr>");
        }
    );
}
var init_st=false;
var init_sa=false;
function loadCheckList(){
    if($("#ServiceTypeId").val().length>0&&!init_st){
        if($("#checkbox_st [type=checkbox]").length>0){
            st = $("#ServiceTypeId").val().split(",");
            for(var sti =0;sti<st.length;sti++ ){
                $("#ServiceTypeId_"+st[sti]).attr('checked','true');
            }
            init_st=true;
        }
    }
    if($("#ServiceAreaId").val().length>0&&!init_sa){
        if($("#checkbox_sa [type=checkbox]").length>0){
            sa = $("#ServiceAreaId").val().split(",");
            for(var sai =0;sai<sa.length;sai++ ){
                $("#ServiceAreaId_"+sa[sai]).attr('checked','true');
            }
            init_sa=true;
        }
        
    }
}

function AddEducation() {
    $.Dialog('/User/EducationAdd.html?userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}
function EditEducation(id) {
    $.Dialog('/User/EducationEdit.html?id=' + id+'&userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}

function DeleteEducation(id) {
    $.confirm("是否确认删除?", function () {
        $.ajaxJson("/planner/back_delete_education", { id: id },
        function (result) {
            loadEducationList(userid);
        },
        function (result) {
            $.alert("删除失败!");
        });
    });
}

function AddSociety() {
    $.Dialog('/User/SocietyAdd.html?userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}
function EditSociety(id) {
    $.Dialog('/User/SocietyEdit.html?id=' + id+'&userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}

function DeleteSociety(id) {
    $.confirm("是否确认删除?", function () {
        $.ajaxJson("/planner/back_delete_society", { id: id },
        function (result) {
            loadSocietyList(userid);
        },
        function (result) {
            $.alert("删除失败!");
        });
    });
}

function AddResour() {
    $.Dialog('/User/ResourAdd.html?userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}
function EditResour(id) {
    $.Dialog('/User/ResourEdit.html?id=' + id+'&userid='+userid,'',650,380);
    //parent.gotoPage('/User/UserEdit.html?id=' + id);
}

function DeleteResour(id) {
    $.confirm("是否确认删除?", function () {
        $.ajaxJson("/planner/back_delete_resour", { id: id },
        function (result) {
            loadResourList(userid);
        },
        function (result) {
            $.alert("删除失败!");
        });
    });
}

</script>
